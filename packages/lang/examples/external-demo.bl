; ============================================
; Bassline Language - External Integration Demo
; HTTP, JSON, String Operations, Context/Map Operations
; ============================================

print "=== STRING OPERATIONS ==="

; split & join
text: "apple,banana,cherry"
fruits: split text ","
print "Fruits:" fruits

joined: join fruits " and "
print "Joined:" joined

; uppercase/lowercase/trim
message: "  Hello World  "
print "Trimmed:" (trim message)
print "Uppercase:" (uppercase message)
print "Lowercase:" (lowercase message)

print "=== JSON OPERATIONS ==="

; Create data and convert to JSON
person: context
in person [
  name: "Alice"
  age: 30
  city: "San Francisco"
]

json-str: to-json person
print "As JSON:" json-str

; Parse JSON back
parsed: parse-json '{"name": "Bob", "age": 25, "active": true}'
print "Parsed:" parsed

print "=== CONTEXT/MAP OPERATIONS ==="

; Get values from context
user-name: get parsed "name"
user-age: get parsed "age"
print "Name:" user-name
print "Age:" (to-string user-age)

; Check if key exists
has-name: has? parsed "name"
has-email: has? parsed "email"
print "Has name:" has-name
print "Has email:" has-email

; Get all keys and values
all-keys: keys parsed
all-values: values parsed
print "Keys:" all-keys
print "Values:" all-values

; Set value (returns new context)
updated: set parsed "email" "bob@example.com"
print "Updated:" updated

print "=== HTTP + JSON (Fetch from API) ==="

; Note: This requires CORS to be enabled or a proxy
; GitHub API is public and CORS-friendly

print "Fetching from GitHub API..."

; Fetch repository data
response: fetch "https://api.github.com/repos/octocat/Hello-World"
data: parse-json response

; Extract fields
repo-name: get data "name"
repo-desc: get data "description"
repo-stars: get data "stargazers_count"
repo-lang: get data "language"

print "Repository:" repo-name
print "Description:" repo-desc
print "Stars:" (to-string repo-stars)
print "Language:" repo-lang

; Get owner info
owner: get data "owner"
owner-login: get owner "login"
print "Owner:" owner-login

print "=== COMPLETE! All external operations working ==="

; Try these interactively in the REPL:
;
; ; Fetch any GitHub repo
; response: fetch "https://api.github.com/repos/anthropics/claude"
; data: parse-json response
; inspect data
;
; ; Get specific fields
; name: get data "name"
; stars: get data "stargazers_count"
; view [
;   text "Repo: " name
;   text "Stars: " (to-string stars)
; ]

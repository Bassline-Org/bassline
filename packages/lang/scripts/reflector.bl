;; This script builds a simple reflector server
;; The context has a broadcast function that will
;; broadcast a message for all connected clients to evaluate

use functions
use sockets

server: make ws-server! "0.0.0.0" 8080

in server [
    broadcast: fn [block] [
        print block
        map (values sessions) (fn [session] [
            cmd: compose [send (block)]
            in session (cmd)
        ])
    ]
]

open server
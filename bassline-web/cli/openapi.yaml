openapi: 3.0.0
info:
  title: Bassline Network API
  description: API for managing Bassline propagation networks
  version: 0.1.0
  contact:
    name: Bassline Team
servers:
  - url: http://localhost:8455
    description: Default local server
paths:
  /state:
    get:
      summary: Get group state
      description: Retrieves the current state of a group including contacts, wires, and subgroups
      parameters:
        - name: groupId
          in: query
          description: ID of the group to retrieve (defaults to 'root')
          required: false
          schema:
            type: string
            default: root
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupState'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /contact:
    post:
      summary: Add contact
      description: Creates a new contact in the specified group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - groupId
                - contact
              properties:
                groupId:
                  type: string
                  description: ID of the group to add contact to
                contact:
                  type: object
                  required:
                    - content
                    - blendMode
                  properties:
                    content:
                      description: Initial content of the contact
                    blendMode:
                      type: string
                      enum: [accept-last, merge]
                      description: How to handle multiple incoming values
                    name:
                      type: string
                      description: Optional human-readable name
                    isBoundary:
                      type: boolean
                      description: Whether this is a boundary contact
                    boundaryDirection:
                      type: string
                      enum: [input, output]
                      description: Direction for boundary contacts
      responses:
        '200':
          description: Contact created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  contactId:
                    type: string
                    description: ID of the created contact
  
  /connect:
    post:
      summary: Create wire
      description: Connects two contacts with a wire
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fromId
                - toId
              properties:
                fromId:
                  type: string
                  description: ID of the source contact
                toId:
                  type: string
                  description: ID of the target contact
                type:
                  type: string
                  enum: [bidirectional, directed]
                  default: bidirectional
                  description: Wire direction type
      responses:
        '200':
          description: Wire created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  wireId:
                    type: string
                    description: ID of the created wire
  
  /update:
    post:
      summary: Update contact
      description: Updates the content of a contact, triggering propagation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - contactId
                - content
              properties:
                contactId:
                  type: string
                  description: ID of the contact to update
                content:
                  description: New content for the contact
      responses:
        '200':
          description: Contact updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    default: true
  
  /groups:
    get:
      summary: List all groups
      description: Returns a list of all groups in the network
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GroupSummary'
    
    post:
      summary: Create group
      description: Creates a new group or subgroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: Name of the group
                parentId:
                  type: string
                  description: ID of parent group (defaults to root)
                primitiveId:
                  type: string
                  description: Primitive gadget type if creating a gadget
      responses:
        '200':
          description: Group created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  groupId:
                    type: string
                    description: ID of the created group
  
  /groups/{groupId}:
    delete:
      summary: Delete group
      description: Removes a group and all its contents
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Group deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    default: true
  
  /primitives:
    get:
      summary: List available primitives
      description: Returns all available primitive gadget types
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PrimitiveInfo'
  
  /wire/{wireId}:
    delete:
      summary: Delete wire
      description: Removes a wire connection
      parameters:
        - name: wireId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Wire deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    default: true
  
  /contact/{contactId}:
    delete:
      summary: Delete contact
      description: Removes a contact
      parameters:
        - name: contactId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Contact deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    default: true

components:
  schemas:
    GroupState:
      type: object
      properties:
        group:
          $ref: '#/components/schemas/Group'
        contacts:
          type: object
          description: Map of contact IDs to Contact objects
          additionalProperties:
            $ref: '#/components/schemas/Contact'
        wires:
          type: object
          description: Map of wire IDs to Wire objects
          additionalProperties:
            $ref: '#/components/schemas/Wire'
    
    Group:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        primitiveId:
          type: string
          description: ID of primitive gadget type if this is a gadget
        parentId:
          type: string
          description: ID of parent group
        contactIds:
          type: array
          items:
            type: string
        wireIds:
          type: array
          items:
            type: string
        subgroupIds:
          type: array
          items:
            type: string
        boundaryContactIds:
          type: array
          items:
            type: string
    
    Contact:
      type: object
      properties:
        id:
          type: string
        content:
          description: Current value held by the contact
        blendMode:
          type: string
          enum: [accept-last, merge]
        groupId:
          type: string
        name:
          type: string
        isBoundary:
          type: boolean
        boundaryDirection:
          type: string
          enum: [input, output]
    
    Wire:
      type: object
      properties:
        id:
          type: string
        fromId:
          type: string
        toId:
          type: string
        type:
          type: string
          enum: [bidirectional, directed]
        groupId:
          type: string
    
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
    
    GroupSummary:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        parentId:
          type: string
        primitiveId:
          type: string
        contactCount:
          type: integer
        wireCount:
          type: integer
        subgroupCount:
          type: integer
    
    PrimitiveInfo:
      type: object
      properties:
        id:
          type: string
          description: Primitive gadget ID
        name:
          type: string
          description: Human-readable name
        description:
          type: string
          description: What this primitive does
        inputs:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
              required:
                type: boolean
        outputs:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
<!DOCTYPE html>
<html>
<head>
    <title>Test Micro-Bassline Worker</title>
</head>
<body>
    <h1>Micro-Bassline Worker Test</h1>
    <div id="status">Initializing...</div>
    <div id="structure"></div>
    <button onclick="createContact()">Create Contact</button>
    <button onclick="ping()">Ping</button>
    
    <script type="module">
        let worker;
        let contactCount = 0;
        
        // Create worker - using the same approach as the React hook
        worker = new Worker(
            new URL('/app/worker/micro-bassline-worker.ts', import.meta.url),
            { type: 'module' }
        );
        
        worker.onmessage = (e) => {
            const { type, value, event } = e.data;
            console.log('Worker message:', e.data);
            
            switch (type) {
                case 'ready':
                    document.getElementById('status').textContent = 'Worker ready!';
                    break;
                case 'structure':
                    document.getElementById('structure').textContent = 
                        'Structure: ' + JSON.stringify(value, null, 2);
                    break;
                case 'pong':
                    alert('Pong received!');
                    break;
            }
        };
        
        worker.onerror = (e) => {
            console.error('Worker error:', e);
            document.getElementById('status').textContent = 'Worker error: ' + e.message;
        };
        
        window.createContact = () => {
            contactCount++;
            worker.postMessage({
                type: 'action',
                action: ['createContact', `test-${contactCount}`, 'app', { blendMode: 'merge' }]
            });
        };
        
        window.ping = () => {
            worker.postMessage({ type: 'ping' });
        };
    </script>
</body>
</html>
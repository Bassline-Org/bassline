<!DOCTYPE html>
<html>
<head>
  <title>Test Latch Behavior</title>
  <script type="module">
    // Import the propagation core
    import { ContactGroup } from './app/propagation-core/models/ContactGroup.js'
    
    console.log('Testing latch behavior for regular contacts...')
    
    // Create a simple network
    const group = new ContactGroup('test', 'Test Group')
    
    // Create three contacts: source -> middle -> target
    const source = group.addContact({ x: 0, y: 0 })
    const middle = group.addContact({ x: 100, y: 0 })
    const target = group.addContact({ x: 200, y: 0 })
    
    console.log('Created contacts:', { source: source.id, middle: middle.id, target: target.id })
    
    // Connect them
    const wire1 = group.connect(source.id, middle.id)
    const wire2 = group.connect(middle.id, target.id)
    
    console.log('Connected contacts with wires')
    
    // Set content on source
    source.setContent(42)
    console.log('Set source content to 42')
    console.log('Middle content:', middle.content) // Should be 42
    console.log('Target content:', target.content) // Should be 42
    
    // Remove wire from source to middle
    group.removeWire(wire1.id)
    console.log('\nRemoved wire from source to middle')
    console.log('Middle content after wire removal:', middle.content) // Should be undefined
    console.log('Target content after wire removal:', target.content) // Should be undefined (propagated from middle)
    
    // Test 2: Latch behavior with multiple sources
    console.log('\n--- Test 2: Multiple sources ---')
    const source2 = group.addContact({ x: 0, y: 100 })
    const shared = group.addContact({ x: 100, y: 50 })
    
    const wire3 = group.connect(source.id, shared.id)
    const wire4 = group.connect(source2.id, shared.id)
    
    source.setContent(10)
    source2.setContent(20)
    console.log('Shared content with two sources:', shared.content) // Should be 20 (last write wins)
    
    // Remove one wire
    group.removeWire(wire3.id)
    console.log('Shared content after removing one wire:', shared.content) // Should still be 20
    
    // Remove the other wire
    group.removeWire(wire4.id)
    console.log('Shared content after removing all wires:', shared.content) // Should be undefined
    
    console.log('\nAll tests completed!')
  </script>
</head>
<body>
  <h1>Latch Behavior Test</h1>
  <p>Check the console for test results</p>
</body>
</html>